<!DOCTYPE html>
<html ng-app="bookList">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="lib/angular.js"></script>
    <style>
        .checked{
            background-color: yellow;
        }
    </style>

    <script>
        angular.module("bookList", []);
        angular.module("bookList").controller("bookListCtrl", function ($scope, $filter, uppercaseFilter, $http) {
            scope = $scope; 
            scope.msg = "Livros";

            var listBooks = function(){
                $http.get('http://localhost:8000/api/v1/books', {
                    headers: {
                        'Authorization': 'Bearer 123456'
                    }
                }).then(function(result) {
                    console.log(result);
                    $scope.books = result.data;
                });
            }

            scope.addBook = function (book){
                $http.post('http://localhost:8000/api/v1/save_books', 
                    book, 
                    {
                    headers: {
                        'Authorization': 'Bearer 123456'
                    }
                }).then(function(result) {
                    scope.books.push(result.data);
                    delete scope.book;
                    //scope.contatoForm.$setPristine();
                    console.log(result);
                }).catch(function(result) {
                    console.log(result.data);
                });
            };
            scope.removeBook = function (contatos){
                scope.books = books.filter(function (book){
                    if(!book.selecionado) return book;               
                });
            };
            scope.isBookSelected = function (book) {
                return book.some(function (book){
                    return book.selecionado;
                });
            }
            $scope.ordenarPor = function(campo){
                $scope.criterio = campo;
                $scope.reverse = !$scope.reverse;
            }

            listBooks();
        })
    </script>
</head>
<body ng-controller="bookListCtrl">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <ol class="breadcrumb panel-heading" style="background: #efc050">
                        <li class="active" style="color:#616161; font-weight:bold" ng-bind="msg | uppercase"></li>
                    </ol>
                    <div class="panel-body">
                        <form class="form-inline" >
                            <div class=" col-md-7">
                                <input type="text" class="form-control" id="name" name="title" placeholder="Livros">
                                <button type="submit" class="btn btn-default"><i class="fa fa-search"></i> Buscar</button>
                            </div>
                            <div class="form-group offset-md-3">
                                <p><a href="newBook.html" class="btn btn-info btn-sm"><i class="fa fa-plus"></i> Adicionar</a></p>
                            </div>
                        </form>
                        <table ng-show="books.length > 0" class="table ">
                            <tr class="text-center">
                                <th></th>
                                <th >Código</th>
                                <th width="20">Capa</th>
                                <th><a href="" ng-click="ordenarPor('title')">Título</a></th>
                                <th>Descrição</th>
                                <th>Ação</th>
                            </tr>
                            <tr ng-class="{checked: book.selecionado}" class="text-center" ng-repeat="book in books | orderBy:criterio:reverse">
                                <td><input type="checkbox" ng-model="book.selecionado"/></td>
                                <td id="code" scope="row">{{ book.id }}</td>
                                <td class="text-center ">
                                    <img onclick="" src="C:/xampp/htdocs/biblioteca/public/images/book/{{ book.image }}" width="100%" style="cursor:pointer" />
                                </td>
                                <td id="booktitle">{{ book.title }}</td>
                                <td>{{ book.description }}</td>
                                <td width="155">
                                    <button onclick="" type="button" class="btn btn-primary btn-sm"><i class="fa fa-pencil"></i></button>
                                    <button onclick="" type="button" class="btn btn-danger btn-sm" ><i class="fa fa-trash"></i></button>
                                </td>
                            </tr>
                        </table>
                        <hr/>
                    </div>
                </div>
            </div>
        </div>
    <br/> 
    <div ng-include="'footer.html'"></div>
</body>
</html>