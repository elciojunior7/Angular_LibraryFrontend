<!DOCTYPE html>
<html ng-app="bookList">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.css">
    <!--script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.js"></script-->

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.6/angular-aria.min.js"></script>
    <!-- Angular Material Library -->
    <script src="https://ajax.googleapis.com/ajax/libs/angular_material/1.1.12/angular-material.min.js"></script>
    <!-- Your application bootstrap -->
    
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="lib/angular.js"></script>
    <style>
        .checked{
            background-color: yellow;
        }
    </style>

    <script>
        angular.module("bookList", ['ngMaterial'])
        .controller("bookListCtrl", function ($scope, $filter, uppercaseFilter, $http, $mdDialog) {
            scope = $scope; 
            scope.msg = "Livros";

            var listBooks = function(){
                $http.get('http://localhost:8000/api/v1/books', {
                    headers: {
                        'Authorization': 'Bearer 123456'
                    }
                }).then(function(result) {
                    console.log(result);
                    $scope.books = result.data;
                });
            }

            scope.addBook = function (book){
                $http.post('http://localhost:8000/api/v1/save_books', 
                    book, 
                    {
                    headers: {
                        'Authorization': 'Bearer 123456'
                    }
                }).then(function(result) {
                    scope.books.push(result.data);
                    delete scope.book;
                    //scope.contatoForm.$setPristine();
                    console.log(result);
                }).catch(function(result) {
                    console.log(result.data);
                });
            };
            scope.removeBook = function (contatos){
                scope.books = books.filter(function (book){
                    if(!book.selecionado) return book;               
                });
            };
            scope.isBookSelected = function (book) {
                return book.some(function (book){
                    return book.selecionado;
                });
            }
            $scope.ordenarPor = function(campo){
                $scope.criterio = campo;
                $scope.reverse = !$scope.reverse;
            }

            listBooks();

            $scope.status = 'veja';
            $scope.customFullscreen = false;

            $scope.showAdvanced = function(ev) {
                var element = angular.element(ev.target);
                $mdDialog.show({
                    locals:{image: element[0].src},
                    controller: DialogController,
                    templateUrl: 'dialogImage.html',
                    parent: angular.element(document.body),
                    targetEvent: ev,
                    clickOutsideToClose:true,
                    fullscreen: $scope.customFullscreen // Only for -xs, -sm breakpoints.
                })
                // .then(function(answer) {
                //     $scope.status = 'You said the information was "' + answer + '".';
                // }, function() {
                //     $scope.status = 'You cancelled the dialog.';
                // });
            };

            function DialogController($scope, $mdDialog, image) {
                $scope.image = image;

                $scope.ok = function() {
                    $mdDialog.hide();
                }
            }
        })
    </script>
</head>
<body ng-controller="bookListCtrl">
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="books.html">BibliotecAí</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
            <div class="navbar-nav">
            <a class="nav-item nav-link" href="authors.html">Autores</a>
            <a class="nav-item nav-link" href="books.html">Livros</a>
            <a class="nav-item nav-link" href="lendings.html">Empréstimos</a>
            </div>
        </div>
    </nav>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <ol class="breadcrumb panel-heading" style="background: #efc050">
                        <li class="active" style="color:#616161; font-weight:bold" ng-bind="msg | uppercase"></li>
                    </ol>
                    <div class="panel-body">
                        <form class="form-inline" >
                            <div class=" col-md-7">
                                <input type="text" class="form-control" id="name" name="title" placeholder="Livros">
                                <button type="submit" class="btn btn-default"><i class="fa fa-search"></i> Buscar</button>
                            </div>
                            <div class="form-group offset-md-3">
                                <p><a href="newBook.html" class="btn btn-info btn-sm"><i class="fa fa-plus"></i> Adicionar</a></p>
                            </div>
                        </form>
                        <table ng-show="books.length > 0" class="table ">
                            <tr class="text-center">
                                <th></th>
                                <th >Código</th>
                                <th width="20">Capa</th>
                                <th><a href="" ng-click="ordenarPor('title')">Título</a></th>
                                <th>Descrição</th>
                                <th>Ação</th>
                            </tr>
                            <tr ng-class="{checked: book.selecionado}" class="text-center" ng-repeat="book in books | orderBy:criterio:reverse">
                                <td><input type="checkbox" ng-model="book.selecionado"/></td>
                                <td id="code" scope="row">{{ book.id }}</td>
                                <td class="text-center ">
                                    <img ng-click="showAdvanced($event)" src="{{'http://localhost:8000/storage/book/' + book.image}}" width="100%" style="cursor:pointer" />
                                </td>
                                <td id="booktitle">{{ book.title }}</td>
                                <td>{{ book.description }}</td>
                                <td width="155">
                                    <button onclick="" type="button" class="btn btn-primary btn-sm"><i class="fa fa-pencil"></i></button>
                                    <button onclick="" type="button" class="btn btn-danger btn-sm" ><i class="fa fa-trash"></i></button>
                                </td>
                            </tr>
                        </table>
                        <hr/>
                    </div>
                </div>
            </div>
        </div>
    <br/> 
    <div class="modal fade" id="imagemodal" tabindex="-1" role="dialog" aria-labelledby="myModal" aria-hidden="true">
        <div class="modal-dialog" style="width: 400px; height: 400px;">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
              <h4 class="modal-title" id="myModal">Capa do Livro</h4>
            </div>
            <div class="modal-body" >
              <img src="" id="imagepreview" style="width: 350px; height: 400px;" >
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
    </div>
  
    <div ng-include="'footer.html'"></div>
</body>
</html>
<script>
    function action(e){ 
        let id = $(e).parent().siblings("#code").html();
        let image = $(e).parent().siblings("#image").data( "image" );
        $("#btnOk").attr("onclick", "remove("+id+",'"+image+"')");
        let book = $(e).parent().siblings("#booktitle").html();
        $("#book").html(book);
        $('#indexModal').modal('show');
    }
    function remove(id, image){ 
        $.ajax({
            type: "post",
            url: "",
            async: false,
            headers: {},
            data : { id: id, image: image },
            success: function (data) {
                console.log(data);
                window.location.href = data.html;
            },
            error: function(data) {
                console.log(data);
            }
        });
    }
    function enlargeCover(e){ 
        $('#imagepreview').attr('src', $(e).attr('src'));
        $('#myModal').html($(e).parent().siblings("#booktitle").html());
        $('#imagemodal').modal('show'); 
    };
</script>